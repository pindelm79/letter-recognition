<!DOCTYPE html>
<html>

<head>
    <title>Letter recognition</title>
    <script type='text/javascript' src='http://cdnjs.cloudflare.com/ajax/libs/fabric.js/1.4.0/fabric.min.js'></script>
    <style type='text/css'>
        #sheet {
            background-color: black;
        }
    </style>
    <script type='text/javascript'>
        window.onload = function () {
            var canvas = new fabric.Canvas('sheet');
            canvas.isDrawingMode = true;
            canvas.freeDrawingBrush.width = 20;
            canvas.freeDrawingBrush.color = "#FFFFFF";
        }
    </script>
</head>

<body>
    <canvas id="sheet" width="400" height="400"></canvas>
    <button onclick="sendImage()">Send</button>

    <script type="text/javascript">
        const sendImage = async () => {
            var canvas = document.getElementById("sheet");
            var image_b64 = canvas.toDataURL().replace("data:image/png;base64,", "");
            const response = await fetch('https://letterrecognitionapi.azurewebsites.net/', {
                method: 'POST',
                body: JSON.stringify({ "image": image_b64 }),
                headers: {
                    'Content-Type': 'application/json'
                }
            });
            const json_response = await response.json();

            predicted = json_response["predicted"]
            probabilities = json_response["probabilities"]

            var predicted_para = document.createElement("P");
            predicted_para.innerText = "Predicted letter: " + predicted;
            document.body.appendChild(predicted_para);

            // Cleanup
            delete probabilities[predicted];
            function clean(obj) {
                for (var propName in obj) {
                    if (obj[propName] === null || obj[propName] === undefined || obj[propName] == 0) {
                        delete obj[propName];
                    }
                }
                return obj
            }
            var probabilities_clean = clean(probabilities)

            var probabilities_para = document.createElement("P");
            probabilities_para.innerText = "Other possibilities: " + JSON.stringify(probabilities_clean);
            document.body.appendChild(probabilities_para);
        }
    </script>
</body>

</html>